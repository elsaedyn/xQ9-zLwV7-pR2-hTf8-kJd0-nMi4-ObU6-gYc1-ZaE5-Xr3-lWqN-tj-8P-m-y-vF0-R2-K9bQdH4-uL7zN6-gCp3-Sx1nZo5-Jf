<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الحصول على مفتاح مجّاني – 5 ساعات</title>
    <style>
        :root {
            --bg: #0b0f18;
            --card: #111827;
            --accent: #22d3ee;
            --text: #e5e7eb;
            --muted: #9ca3af;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: radial-gradient(1200px 600px at 80% -20%, #10203a22, transparent), var(--bg);
            font-family: system-ui, -apple-system, Segoe UI, Roboto;
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .wrap {
            max-width: 720px;
            margin: 6vh auto;
            padding: 16px;
        }
        
        .card {
            background: linear-gradient(135deg, #0f172a, #0b1220);
            border: 1px solid #1f2937;
            box-shadow: 0 20px 60px #0007;
            border-radius: 24px;
            padding: 28px;
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(34, 211, 238, 0.1) 0%, transparent 70%);
            transform: rotate(30deg);
            pointer-events: none;
        }
        
        h1 {
            margin-top: 0;
            font-size: 28px;
            letter-spacing: 0.5px;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .sub {
            color: var(--muted);
            text-align: center;
            margin-bottom: 20px;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            background: linear-gradient(135deg, #1f6feb, #22d3ee);
            color: #021014;
            border: none;
            border-radius: 14px;
            padding: 14px 20px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: 0.2s transform;
            width: 100%;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .row {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 16px;
        }
        
        .inp {
            flex: 1;
            background: #0b1020;
            border: 1px solid #1f2a44;
            color: #cfe9ff;
            padding: 12px 14px;
            border-radius: 12px;
            font-family: monospace;
        }
        
        .copy {
            background: #0ea5e9;
            border: none;
            color: #00121a;
            padding: 12px 14px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            min-width: 80px;
        }
        
        .ad {
            height: 120px;
            border: 1px dashed #334155;
            border-radius: 12px;
            margin: 14px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #7aa2c1;
            background: rgba(15, 23, 42, 0.5);
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                text-shadow: 0 0 5px rgba(34, 211, 238, 0.7);
            }
            50% {
                text-shadow: 0 0 20px rgba(34, 211, 238, 0.9);
            }
            100% {
                text-shadow: 0 0 5px rgba(34, 211, 238, 0.7);
            }
        }
        
        .countdown {
            font-size: 18px;
            font-weight: bold;
            color: var(--accent);
            margin: 10px 0;
            text-align: center;
        }
        
        .loader {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            display: none;
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        .success-check {
            color: #10b981;
            font-size: 20px;
            display: none;
        }
        
        .key-display {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid #1f2937;
        }
        
        .key-title {
            color: var(--muted);
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .key-value {
            font-family: monospace;
            color: var(--accent);
            font-size: 18px;
            word-break: break-all;
        }
        
        .footer {
            text-align: center;
            margin-top: 20px;
            color: var(--muted);
            font-size: 12px;
        }
        
        @media (max-width: 600px) {
            .wrap {
                padding: 10px;
                margin: 3vh auto;
            }
            
            .card {
                padding: 20px;
            }
            
            .row {
                flex-direction: column;
            }
            
            .copy {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="wrap">
        <div class="card">
            <h1 class="pulse">احصل على مفتاح <span style="color:var(--accent)">لمدّة 5 ساعات</span></h1>
            <div class="sub">الزرّ سيولِّد مفتاحًا بالشكل <code>albob_golem_XXXXXXX_5h</code> ويضيفه تلقائيًا داخل <code>key_free.txt</code>.</div>

            <div id="gate" class="ad">
                <div>يرجى الانتظار <span id="countdown">5</span> ثوانٍ قبل إنشاء المفتاح</div>
            </div>

            <button id="go" class="btn" disabled>
                <span id="btn-text">إنشاء المفتاح الآن</span>
                <span id="btn-loader" class="loader"></span>
                <span id="btn-success" class="success-check">✓</span>
            </button>

            <div class="key-display" style="display: none;">
                <div class="key-title">المفتاح الذي تم إنشاؤه:</div>
                <div id="key-value" class="key-value"></div>
            </div>

            <div class="row">
                <input id="key" class="inp" placeholder="المفتاح يظهر هنا" readonly />
                <button id="copyKey" class="copy">نسخ</button>
            </div>
            
            <div class="row">
                <input id="url" class="inp" placeholder="الرابط (يعرض مع أحرف غريبة بعد /)" readonly />
                <button id="open" class="copy">فتح</button>
            </div>

            <div class="footer">
                © 2023 جميع الحقوق محفوظة
            </div>
        </div>
    </div>

    <script>
        // منع فتح أدوات المطور
        document.addEventListener('keydown', function(e) {
            if (e.keyCode == 123) { // F12
                e.preventDefault();
                return false;
            }
            
            if (e.ctrlKey && e.shiftKey && e.keyCode == 73) { // Ctrl+Shift+I
                e.preventDefault();
                return false;
            }
            
            if (e.ctrlKey && e.shiftKey && e.keyCode == 74) { // Ctrl+Shift+J
                e.preventDefault();
                return false;
            }
            
            if (e.ctrlKey && e.keyCode == 85) { // Ctrl+U
                e.preventDefault();
                return false;
            }
        });
        
        // منع النقر بزر الماوس الأيمن
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
        });
        
        // إعداد المتغيرات
        const GITHUB_TOKEN = "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";
        
        const REPO_URL = "https://raw.githubusercontent.com/elsaedyn/key/main/key_free.txt";
        
        const gateMs = 5000;
        
        const goBtn = document.getElementById("go");
        
        const gate = document.getElementById("gate");
        
        const countdownEl = document.getElementById("countdown");
        
        const keyInp = document.getElementById("key");
        
        const urlInp = document.getElementById("url");
        
        const copyKeyBtn = document.getElementById("copyKey");
        
        const openBtn = document.getElementById("open");
        
        const btnText = document.getElementById("btn-text");
        
        const btnLoader = document.getElementById("btn-loader");
        
        const btnSuccess = document.getElementById("btn-success");
        
        const keyValue = document.getElementById("key-value");
        
        const keyDisplay = document.querySelector(".key-display");
        
        // تشويش مستمر لمسار الصفحة
        let noiseTimer = null;
        
        function startUrlNoise() {
            function noise() {
                const junkChars = "۞٪#~¿¤®¦¬£¢¡»«©§¶±‗░▒▓│┤╡╢╖╕╣║╗╝╜╛┐└┴┬├─┼╞╟╚╔╩╦╠═╬╧╨╤╥╙╘╒╓╫╪┘┌█▄▌▐▀ـ؋؉؈؇؆؅؄؃؁؀ٰۥۣۤۢ۠۟۞۝ۜۛۚۙۘۗۖە۔ۓۑېۏێۍیۋۊۉۈۇۆۅۄۃۂہەؠ؆؅؄؃؂؁ࣰࣱࣲࣺࣹࣶ࣯࣮࣭ࣩࣦࣣࣿࣾࣽࣸࣷࣵࣴࣳ࣬࣫࣪ࣨࣧࣥࣤ࣢࣓࣒࣑࣐࣏࣡࣠ࣟࣞࣝࣜࣛࣚࣙࣘࣗࣖࣕࣔ࣎࣍࣌࣋࣊ࣉࣈࣇࣆࣅࣄࣃࣂࣁࣀ";
                
                let junk = "";
                
                for (let i = 0; i < 12; i++) {
                    junk += junkChars[Math.floor(Math.random() * junkChars.length)];
                }
                
                junk += "_" + Date.now();
                
                history.replaceState({}, "", "/" + junk);
            }
            
            noise();
            // سرعة التشويش: كل 100ms بدل 900ms
            noiseTimer = setInterval(noise, 100);
        }
        
        startUrlNoise();
        
        // عداد تنازلي للبوابة
        let countdown = gateMs / 1000;
        
        countdownEl.textContent = countdown;
        
        const countdownInterval = setInterval(() => {
            countdown--;
            
            countdownEl.textContent = countdown;
            
            if (countdown <= 0) {
                clearInterval(countdownInterval);
                
                gate.innerHTML = "<div>جاهز! يمكنك الآن إنشاء المفتاح</div>";
                
                goBtn.disabled = false;
            }
        }, 1000);
        
        // توليد مفتاح عشوائي
        function generateRandomKey() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            
            let result = '';
            
            for (let i = 0; i < 7; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            
            return result;
        }
        
        // مدة الانتظار بين الأكواد (5 ساعات)
        const COOLDOWN_HOURS = 5;
        const COOLDOWN_MS = COOLDOWN_HOURS * 60 * 60 * 1000;
        const LAST_KEY_TIME_KEY = "last_key_time";

        function getCooldownRemaining() {
            const lastTime = localStorage.getItem(LAST_KEY_TIME_KEY);
            if (!lastTime) return 0;
            const elapsed = Date.now() - Number(lastTime);
            return Math.max(0, COOLDOWN_MS - elapsed);
        }

        function formatTime(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            return `${hours}س ${minutes}د ${seconds}ث`;
        }

        function showCooldown() {
            const remaining = getCooldownRemaining();
            if (remaining > 0) {
                goBtn.disabled = true;
                btnText.textContent = `انتظر ${formatTime(remaining)} قبل طلب كود جديد`;
                btnLoader.style.display = "none";
                btnSuccess.style.display = "none";
                // تحديث الوقت كل ثانية
                let interval = setInterval(() => {
                    const left = getCooldownRemaining();
                    if (left <= 0) {
                        clearInterval(interval);
                        btnText.textContent = "إنشاء المفتاح الآن";
                        goBtn.disabled = false;
                    } else {
                        btnText.textContent = `انتظر ${formatTime(left)} قبل طلب كود جديد`;
                    }
                }, 1000);
                return true;
            }
            return false;
        }

        // عند تحميل الصفحة، تحقق من الكول داون
        window.addEventListener("DOMContentLoaded", () => {
            showCooldown();
        });
        
        // توليد المفتاح ورفعه إلى GitHub
        goBtn.addEventListener("click", async () => {
            // تحقق من الكول داون قبل الإنشاء
            if (getCooldownRemaining() > 0) {
                showCooldown();
                return;
            }
            goBtn.disabled = true;
            btnText.textContent = "جارٍ الإنشاء والرفع…";
            btnLoader.style.display = "inline-block";
            
            try {
                // توليد المفتاح
                const randomPart = generateRandomKey();
                
                const newKey = `albob_golem_${randomPart}_5h`;
                
                // محاولة جلب المفاتيح الحالية من GitHub (من الـ API وليس raw)
                let currentKeys = "";
                let currentSha = null;
                try {
                    const response = await fetch('https://api.github.com/repos/elsaedyn/key/contents/key_free.txt', {
                        headers: {
                            'Authorization': `token ${GITHUB_TOKEN}`
                        }
                    });
                    if (response.ok) {
                        const data = await response.json();
                        currentSha = data.sha;
                        currentKeys = decodeURIComponent(escape(atob(data.content)));
                    }
                } catch (e) {
                    console.log("لم يتم العثور على ملف أو لا يمكن الوصول إليه، سيتم إنشاء ملف جديد");
                }

                // إضافة المفتاح الجديد في آخر سطر بدون حذف أي مفتاح سابق
                let updatedKeys = currentKeys ? currentKeys.replace(/\r\n/g, '\n').replace(/\n+$/g, '') : '';
                if (updatedKeys.length > 0) {
                    updatedKeys += "\n" + newKey;
                } else {
                    updatedKeys = newKey;
                }

                // رفع المفاتيح المحدثة إلى GitHub
                const uploadResponse = await fetch('https://api.github.com/repos/elsaedyn/key/contents/key_free.txt', {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: 'إضافة مفتاح جديد',
                        content: btoa(unescape(encodeURIComponent(updatedKeys))),
                        sha: currentSha
                    })
                });
                
                if (!uploadResponse.ok) {
                    const errorData = await uploadResponse.json();
                    
                    throw new Error(errorData.message || "فشل في رفع الملف إلى GitHub");
                }
                
                // عرض النتائج للمستخدم
                keyInp.value = newKey;
                
                keyValue.textContent = newKey;
                
                keyDisplay.style.display = "block";
                
                const displayUrl = `${window.location.origin}/${Math.random().toString(36).substring(2, 10)}_${randomPart}_${Date.now().toString(36)}`;
                
                urlInp.value = displayUrl;
                
                btnLoader.style.display = "none";
                
                btnSuccess.style.display = "inline-block";
                
                btnText.textContent = "تم الإنشاء والرفع بنجاح!";
                
                // بعد الإنشاء الناجح، خزّن وقت الطلب
                localStorage.setItem(LAST_KEY_TIME_KEY, Date.now().toString());
            } 
            catch (e) {
                console.error(e);
                
                alert("فشل إنشاء/رفع المفتاح. تأكد أن السيرفر يعمل وأن GITHUB_TOKEN مضبوط.");
                
                btnText.textContent = "حاول مجددًا";
                
                btnLoader.style.display = "none";
                
                goBtn.disabled = false;
            }
        });
        
        // الحصول على SHA الملف الحالي (لعملية التحديث)
        async function getFileSHA() {
            try {
                const response = await fetch('https://api.github.com/repos/elsaedyn/key/contents/key_free.txt', {
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    return data.sha;
                }
            } 
            catch (e) {
                console.error("فشل في الحصول على SHA الملف:", e);
            }
            
            return null;
        }
        
        copyKeyBtn.addEventListener("click", async () => {
            if (!keyInp.value) return;
            
            try { 
                await navigator.clipboard.writeText(keyInp.value); 
                
                copyKeyBtn.textContent = "نُسخ!"; 
                
                setTimeout(() => copyKeyBtn.textContent = "نسخ", 1200);
            } 
            catch {}
        });
        
        openBtn.addEventListener("click", () => {
            if (!urlInp.value) return;
            
            // افتح الرابط "المشوّه" في علامة جديدة
            window.open(urlInp.value, "_blank", "noopener,noreferrer");
        });
    </script>
</body>
</html>